{% extends "base.html" %}

{% block contents %}


<form method="post">
  {% csrf_token %}

  <div class="pure-u-1">
    <div style="padding: 5px;">
      <table style="width: 100%;" class="pure-table pure-table-striped">
	<thead>
	  <tr>
	    <th>Personnage</th>
	    <th>Modificateurs</th>
	    <th>Effets actifs</th>
	  </tr>
	</thead>
	<tbody>
	  {% for character in characters %}
	  <tr>
	    <td>{{ character.name }}

	      {% if request.user in character.players.all %}
	      <button class="pure-button pure-button-primary" style="font-size: x-small" type="submit" name="end-turn" value="{{ character.id }}">Terminer le tour</button>
	      {% endif %}
	    </td>

	    <td>
	      {% for name, stat in character.stats %}
	      {% if not forloop.first %}; {% endif %}
	      {{ name }}
	      <abbr title="{% for name, value in stat.detail %}{% if value > 0 %}+{% endif %}{{ value }} {{name}}{% endfor %}">{% if stat.value > 0 %}+{{ stat.value }}{% else %}{{ stat.value }}{% endif %}</abbr>
	      {% if stat.constraints %}
	      ({% for constraint, value, detail in stat.constraints %}{% if not forloop.first %}, {% endif %}<abbr
														title="{% for name, value in detail %}{% if value > 0 %}+{% endif %}{{ value }} {{name }}{% endfor %}">{% if value > 0%}+{% endif %}{{ value }}</abbr>
	      {{ constraint }}{% endfor %})
	      {% endif %}
	      {% endfor %}
	    </td>
	    <td>{% for buff in character.buffs %}
	      {% if not forloop.first %}; {% endif %}
	      <abbr title="{{ buff.description }}">{{ buff }}</abbr>
	      {% endfor %}
	    </td>
	  </tr>
	  {% endfor %}
	</tbody>
      </table>
    </div>
  </div>

  <div class="pure-u-1">
    <div class="pure-g">
      <div class="pure-u-1-2">
	{% if buffs_formset %}
	<div style="padding: 5px;">
	  {{ buffs_formset.management_form }}
	  <table style="width: 100%;" class="pure-table pure-table-horizontal">
	    <thead>
	      <tr>
		{% for form in buffs_formset.forms %}
		{% if forloop.first %}
		{% for field in form %}
		{% if not field.is_hidden %}
		<th>{{ field.label }}</th>
		{% endif %}
		{% endfor %}
	      </tr>
	    </thead>
	    <tbody>
	      {% endif %}
	      <tr>
		<td>
		  {% for field in form %}
		  {% if field.is_hidden %} {{ field }} {% else %}{% if not forloop.first %}</td> <td>{%endif%} {{ field }}{% endif %}
		  {% endfor %}
		</td>
	      </tr>
	      {% endfor %}
	    </tbody>
	  </table>
	  <button type="submit" class="pure-button pure-button-primary" style="width: 100%;">Enregistrer</button>
	</div>
	{% endif %}
      </div>


      <div class="pure-u-1-2">
	<div style="padding: 5px;">
	  <table style="width: 100%;" class="pure-table pure-table-striped">
	    <thead>
	      <tr>
		<th colspan="3">RÃ©capitulatif</th>
	      </tr>
	    </thead>
	    <tbody>
	      {% for source in sources %}
	      <tr>
		<td style="font-style: italic;">
		  {{ source }}
		</td>
		<td>{{ source.description }}</td>
	      </tr>
	      {% endfor %}
	    </tbody>
	  </table>
	</div>
      </div>
    </div>
  </div>
</form>
{% endblock %}

